<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–æ–≤</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="sidebar">
        <div class="bot-info">
            <h3 style="margin-bottom: 10px; color: #333;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h3>
            <input type="text" id="bot-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞" value="–ú–æ–π–ë–æ—Ç">
            <input type="text" id="bot-token" placeholder="–¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        </div>

        <h2>–ë–ª–æ–∫–∏</h2>
        
        <div class="block-type" draggable="true" data-type="start">
            üöÄ –°—Ç–∞—Ä—Ç
        </div>
        
        <div class="block-type" draggable="true" data-type="message">
            üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ
        </div>
        
        <div class="block-type" draggable="true" data-type="question">
            ‚ùì –í–æ–ø—Ä–æ—Å
        </div>
        
        <div class="block-type" draggable="true" data-type="choice">
            üéØ –í—ã–±–æ—Ä
        </div>
        
        <div class="block-type" draggable="true" data-type="condition">
            üîÄ –£—Å–ª–æ–≤–∏–µ
        </div>
        
        <div class="block-type" draggable="true" data-type="delay">
            ‚è∞ –ó–∞–¥–µ—Ä–∂–∫–∞
        </div>
        
        <div class="block-type" draggable="true" data-type="variable">
            üìù –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è
        </div>
        
        <div class="block-type" draggable="true" data-type="loop">
            üîÑ –¶–∏–∫–ª
        </div>

        <h3 style="margin-top: 20px; margin-bottom: 10px; color: #666; font-size: 16px;">E-commerce</h3>
        
        <div class="block-type" draggable="true" data-type="image">
            üì∏ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        </div>
        
        <div class="block-type" draggable="true" data-type="inline_keyboard">
            ‚å®Ô∏è Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        </div>
        
        <div class="block-type" draggable="true" data-type="calculation">
            üßÆ –í—ã—á–∏—Å–ª–µ–Ω–∏—è
        </div>
        
        <div class="block-type" draggable="true" data-type="cart">
            üõí –ö–æ—Ä–∑–∏–Ω–∞
        </div>
        
        <div class="block-type" draggable="true" data-type="payment">
            üí≥ –û–ø–ª–∞—Ç–∞
        </div>
        
        <div class="block-type" draggable="true" data-type="database">
            üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
        </div>
        
        <div class="block-type" draggable="true" data-type="catalog">
            üìã –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
        </div>
        
        <div class="block-type" draggable="true" data-type="order_form">
            üìù –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞
        </div>
        
        <div class="block-type" draggable="true" data-type="notification">
            üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        </div>
        
        <div class="block-type" draggable="true" data-type="order_confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        </div>

        <h3 style="margin-top: 20px; margin-bottom: 10px; color: #666; font-size: 16px;">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h3>
        
        <div class="block-type" draggable="true" data-type="chatgpt">
            ü§ñ ChatGPT
        </div>
    </div>

    <div class="main-area">
        <div class="toolbar collapsible">
            <button class="btn" onclick="clearCanvas()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn btn-undo" onclick="historyManager.undo()" id="undo-btn" disabled title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z / Ctrl+–Ø)">‚Ü∂ –û—Ç–º–µ–Ω–∏—Ç—å</button>
            <button class="btn btn-redo" onclick="historyManager.redo()" id="redo-btn" disabled title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y / Ctrl+–ù)">‚Ü∑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="toggleConnectMode()" id="connect-btn" title="–°–æ–µ–¥–∏–Ω–∏—Ç—å –±–ª–æ–∫–∏ (–ü–ö–ú –¥–ª—è –æ—Ç–º–µ–Ω—ã)">üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="toggleBreakMode()" id="break-btn" title="–†–∞–∑–æ—Ä–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ü–ö–ú –¥–ª—è –æ—Ç–º–µ–Ω—ã)">‚úÇÔ∏è –†–∞–∑–æ—Ä–≤–∞—Ç—å</button>
            <button class="btn btn-secondary" onclick="previewBot()">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
            <button class="btn" onclick="exportBot()">üì• –≠–∫—Å–ø–æ—Ä—Ç Python</button>
            <button class="btn btn-secondary" onclick="saveToFile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª</button>
            <button class="btn btn-secondary" onclick="loadFromFile()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
            <button class="btn btn-theme" onclick="toggleTheme()" id="theme-btn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô –¢–µ–º–∞</button>
            <div class="toolbar-spacer"></div>
            <div class="toolbar-right-fixed">
                <button id="toggle-sidebar-btn" class="btn btn-secondary" onclick="toggleSidebar()" title="–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ª–µ–≤—É—é –ø–∞–Ω–µ–ª—å">—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å</button>
                <button id="toggle-toolbar-btn" class="btn btn-secondary" onclick="toggleToolbar()" title="–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å —Ç—É–ª–±–∞—Ä">—Å–∫—Ä—ã—Ç—å —Ç—É–ª–±–∞—Ä</button>
            </div>
        </div>
        
        <div class="hash-output">
            <label for="bot-hash">–•–µ—à –±–æ—Ç–∞ (–∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è):</label>
            <input type="text" id="bot-hash" readonly onclick="copyHashToClipboard()" style="cursor: pointer;">
        </div>

        <div class="canvas" id="canvas">
            <div class="zoom-indicator hidden" id="zoom-indicator">100%</div>
            <button class="center-canvas-btn" onclick="centerCanvas()" title="–¶–µ–Ω—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–±—Ä–æ—Å–∏—Ç—å –∑—É–º (100%)">üéØ –¶–µ–Ω—Ç—Ä–æ–≤–∞—Ç—å</button>
            <div class="canvas-content" id="canvas-content">
                <svg class="arrow-svg" id="arrow-svg" width="1000" height="600" viewBox="0 0 1000 600">
                    <defs>
                        <marker id="arrowhead" markerWidth="12" markerHeight="8" 
                                refX="11" refY="4" orient="auto">
                            <polygon points="0 0, 12 4, 0 8" fill="#00b894" stroke="#00a085" stroke-width="0.5" />
                        </marker>
                    </defs>
                </svg>
                <div class="empty-canvas">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±–ª–æ–∫–∏ —Å—é–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞<br>
                    <small style="color: rgba(255,255,255,0.7); font-size: 0.9em;">üí° –ó–∞–∂–º–∏—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –º—ã—à–∫–æ–π –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ö–æ–ª—Å—Ç—É</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Edge reopen buttons (always reachable) -->
    <button id="edge-open-toolbar" class="edge-toggle edge-top-right hidden" onclick="toggleToolbar()">–ø–æ–∫–∞–∑–∞—Ç—å —Ç—É–ª–±–∞—Ä</button>
    <button id="edge-toggle-sidebar" class="edge-toggle edge-top-right-secondary hidden" onclick="toggleSidebar()">—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å</button>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" id="file-input" accept=".bot,.json" style="display: none;">

    <!-- –ú–æ–¥—É–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="js/utils/Utils.js"></script>
    <script src="js/utils/PythonExporter.js"></script>
    <script src="js/core/HistoryManager.js"></script>
    <script src="js/blocks/BlockGenerator.js"></script>
    <script src="js/canvas/CanvasManager.js"></script>
    <script src="js/canvas/ConnectionManager.js"></script>
    <script src="js/core/BotSimulator.js"></script>
    <script src="js/core/BotBuilder.js"></script>
    <script src="js/app_new.js"></script>
    
    <!-- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–¥–ª—è –æ—Ç–∫–∞—Ç–∞ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º) -->
    <!-- <script src="js/app.js"></script> -->

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
    <div id="preview-modal" class="preview-modal hidden">
        <div class="preview-container">
            <div class="preview-header">
                <h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –±–æ—Ç–∞</h3>
                <button class="preview-close" onclick="closePreview()">&times;</button>
            </div>
            <div class="preview-chat" id="preview-chat">
                <div class="preview-messages" id="preview-messages"></div>
            </div>
            <div class="preview-input-area" id="preview-input-area">
                <input type="text" id="preview-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
                <button onclick="sendPreviewMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
</body>
</html>
